 namespace = ark_game_start

# 部分初始设定
planet_event = {
	id = ark_game_start.1
	hide_window = yes
	is_triggered_only = yes

	immediate = {
		if = {
			limit = { has_planet_flag = planet_terra }	# 前提:是泰拉星球
			generate_terra_deposits_and_blockers = yes	# 初始地块
			arknight_start_districts = yes	# 初始区划
		}
	}
}

# 与"Warship Girls R And MIST Species"联动
event = {
	id = ark_game_start.2
	hide_window = yes
	is_triggered_only = yes

	trigger = {
		NOT = { has_global_flag = arknights_swimming }
	}

	immediate = {
		set_global_flag = arknights_swimming
	}
}

# 进行明日方舟国家的区分并添加效果
country_event = {
	id = ark_game_start.3
	title = "ark_game_start.3.name"
	desc = {		# 使用了预设/修改的预设
		trigger = {
			OR = {
				has_country_flag = arknight_1
				has_country_flag = arknight_2
			}
		}
		text = ark_game_start.3.1.desc
	}
	desc = {		# 未使用预设/修改的预设
		trigger = {
			NOR = {
				has_country_flag = arknight_1
				has_country_flag = arknight_2
			}
		}
		text = ark_game_start.3.2.desc	# 询问是否作为明日方舟国家
	}
	picture = GFX_evt_arknights_amiya
	location = ROOT

	is_triggered_only = yes

	trigger = {
		root = { is_species_class = Arknight }	# 是泰拉人种族
		capital_scope = { has_planet_flag = planet_terra }	# 母星是泰拉
		owner_species = { has_trait = trait_latent_oripathy }	# 有种族特性"源石病潜势"
		NOT = { has_ethic = ethic_gestalt_consciousness }	# 非格式塔
	}

	immediate = {
	}
	
	option = {
		name = ark_game_start.3.1.a	# 确认（城邦共和制）
		trigger = {
			has_authority = auth_city_republic	# 是城邦共和制
		}
		hidden_effect = {
			give_technology = { tech = tech_originiums_mining message = no }	# 初始科技
			add_modifier = { modifier = "terra_council" days = 120 }			# 联合会议准备中
			country_event = { id = ark_rhodes_island.1 }				# 创建罗德岛
			country_event = { id = ark_game_start.31 }				# 初始领袖设定
			random_owned_planet = {
				limit = { has_planet_flag = planet_terra }
				add_modifier = { modifier = "nomadic_city" days = -1 }		# 移动城邦
				add_modifier = { modifier = "barbarian_growth" days = -1 }	# 野蛮生长
			}
		}
	}
	
	option = {
		name = ark_game_start.3.1.a	# 确认（城邦专制）
		trigger = {
			has_authority = auth_city_despotism	# 是城邦专制
		}
		hidden_effect = {
			give_technology = { tech = tech_originiums_mining message = no }	# 初始科技
			country_event = { id = ark_game_start.31 }				# 初始领袖设定
			random_owned_planet = {
				limit = { has_planet_flag = planet_terra }
				add_modifier = { modifier = "nomadic_city" days = -1 }		# 移动城邦
				add_modifier = { modifier = "barbarian_growth" days = -1 }	# 野蛮生长
			}
		}
	}
	
	option = {
		name = ark_game_start.3.2.a	# 是的（同意作为明日方舟国家）
		trigger = {
			NOR = {		# 未使用预设/修改的预设
				has_country_flag = arknight_1
				has_country_flag = arknight_2
			}
		}
		hidden_effect = {
			set_country_flag = arknight_4
			give_technology = { tech = tech_originiums_mining message = no }	# 初始科技
			country_event = { id = ark_game_start.31 }				# 初始领袖设定
			random_owned_planet = {
				limit = { has_planet_flag = planet_terra }
				add_modifier = { modifier = "nomadic_city" days = -1 }		# 移动城邦
			}
		}
	}

	option = {
		name = ark_game_start.3.2.b	# 不，我另有打算（不作为明日方舟国家）
		trigger = {
			NOR = {		# 未使用预设/修改的预设
				has_country_flag = arknight_1
				has_country_flag = arknight_2
			}
		}
	}
}

# 初始领袖设定（玩家设定的国家名字）
country_event = {
	id = ark_game_start.31
	title = "ark_game_start.31.name"
	desc = "ark_game_start.31.desc"
	picture = GFX_evt_rhodes_island
	location = ROOT

	is_triggered_only = yes

	immediate = {
	}
	
	option = {
		name = ark_game_start.31.a	# 凯尔希作为新的ruler开始游戏
		trigger = {
			has_country_flag = arknight_1	# 预设/修改的泰拉联合世界
		}
		custom_tooltip = ark_game_start.31.a_tooltip
		hidden_effect = {
			every_owned_leader = {
				kill_leader = { type = ruler show_notification = no }
		   	}
			create_leader = {
				class = scientist
				species = owner_main_species
				gender = female
				name = NAME_Kaltsit
				skill = 1
				traits = {
					add_trait = trait_ruler_walk_in_dust_r
					add_trait = trait_ruler_kaltsit_knowledgeable
					add_trait = leader_trait_oripathy	# 源石病
				}
				effect = {
					set_leader_flag = ark_leader_kaltsit
					save_event_target_as = leader_kaltsit
					add_trait = leader_trait_walk_in_dust_s
					add_trait = leader_trait_unknown_technology
					add_trait = leader_trait_expertise_industry
					add_trait = leader_trait_expertise_biology
					add_trait = leader_trait_archaeologist
					add_ruler_trait = leader_trait_oripathy	# 源石病
					add_ruler_trait = trait_ruler_walk_in_dust_r
					add_ruler_trait = trait_ruler_kaltsit_knowledgeable
				}				
			}
			last_created_leader = {
				set_age = 25302
				change_leader_portrait = ARK003
				set_is_female = yes
			}
			set_leader = last_created_leader
			add_resource = { influence = 100 }
			country_event = { id = ark_game_start.311 }
		}
	}
	
	option = {
		name = ark_game_start.31.b	# DOCTOR作为新的ruler开始游戏（蓝）
		trigger = {
			has_country_flag = arknight_1	# 预设/修改的泰拉联合世界
		}
		custom_tooltip = ark_game_start.31.b_tooltip
		hidden_effect = {
			every_owned_leader = {
				kill_leader = { type = ruler show_notification = no }
		   	}
			create_leader = {
				class = scientist
				species = owner_main_species
				gender = male
				name = NAME_Doctor
				skill = 3
				traits = {
					add_trait = trait_scientist_meet_end
					add_trait = leader_trait_expertise_biology
					add_trait = leader_trait_expertise_military_theory
				}
				effect = {
					set_leader_flag = ark_leader_doctor
					save_event_target_as = leader_doctor
					add_trait = leader_trait_expertise_biology
					add_trait = leader_trait_expertise_military_theory
					add_ruler_trait = trait_ruler_efficient_infrastructure
					add_ruler_trait = trait_ruler_babel_evil_spirit_l
					add_ruler_trait = trait_ruler_meet_end
				}
			}
			last_created_leader = {
				set_age = 30
				change_leader_portrait = ARK001
				set_is_female = no
			}
			set_leader = last_created_leader
			add_resource = { influence = 100 }
			country_event = { id = ark_game_start.313 }
		}
	}
	
	option = {
		name = ark_game_start.31.c	# DOCTOR作为新的ruler开始游戏（白）
		trigger = {
			has_country_flag = arknight_2	# 预设/修改的泰拉秩序
		}
		custom_tooltip = ark_game_start.31.c_tooltip
		hidden_effect = {
			create_leader = {
				class = scientist
				species = owner_main_species
				gender = male
				name = NAME_Doctor
				skill = 3
				traits = {
					add_trait = trait_scientist_meet_end
					add_trait = leader_trait_expertise_biology
					add_trait = leader_trait_expertise_military_theory
				}
				effect = {
					set_leader_flag = ark_leader_doctor
					save_event_target_as = leader_doctor
					add_trait = leader_trait_expertise_biology
					add_trait = leader_trait_expertise_military_theory
					add_ruler_trait = trait_ruler_babel_evil_spirit_w
					add_ruler_trait = trait_ruler_meet_end
				}				
			}
			last_created_leader = {
				set_age = 30
				change_leader_portrait = ARK001_W
				set_is_female = no
			}
			set_leader = last_created_leader
			country_event = { id = ark_game_start.313 }
		}
	}

	option = {
		name = ark_game_start.31.d	# 使用玩家的设定开始游戏
		custom_tooltip = ark_game_start.31.d_tooltip
	}
}

# 凯尔希作为新的ruler开始游戏
country_event = {
	id = ark_game_start.311
	hide_window = yes
	location = ROOT

	is_triggered_only = yes

	immediate = {
		every_owned_leader = {
			limit = {
				has_leader_flag = ark_leader_kaltsit
			}
			remove_trait = trait_ruler_corvette_focus
			remove_trait = trait_ruler_destroyer_focus
			remove_trait = trait_ruler_cruiser_focus
			remove_trait = trait_ruler_battleship_focus
			remove_trait = trait_ruler_recruiter
			remove_trait = trait_ruler_from_the_ranks
			remove_trait = trait_ruler_fortifier
			remove_trait = trait_ruler_logistic_understanding
			remove_trait = trait_ruler_military_pioneer
			remove_trait = trait_ruler_warlike
			remove_trait = trait_ruler_architectural_sense
			remove_trait = trait_ruler_frontier_spirit
			remove_trait = trait_ruler_world_shaper
			remove_trait = trait_ruler_home_in_the_sky
			remove_trait = trait_ruler_industrialist
			remove_trait = trait_ruler_eye_for_talent
			remove_trait = trait_ruler_deep_connections
			remove_trait = trait_ruler_charismatic
			remove_trait = trait_ruler_champion_of_the_people
			remove_trait = trait_ruler_expansionist
			remove_trait = trait_ruler_fertility_preacher
			remove_trait = trait_ruler_investor
			remove_trait = trait_ruler_space_miner
			remove_trait = trait_ruler_explorer
			remove_trait = leader_trait_reformer
			remove_trait = leader_trait_resilient
			remove_trait = leader_trait_tiandaochouqin	# 天道酬勤
		}
	}
}

# 凯尔希卸任后清除新统治者错误的凯尔希技能
country_event = {
	id = ark_game_start.312
	hide_window = yes
	location = ROOT
	is_triggered_only = yes
	trigger = {
		any_owned_leader = {
			leader_class = ruler
			NOT = { has_leader_flag = ark_leader_kaltsit }
		}
	}

	immediate = {
		every_owned_leader = {
			limit = { leader_class = ruler }
			remove_ruler_trait = trait_ruler_walk_in_dust_r
			remove_ruler_trait = trait_ruler_kaltsit_knowledgeable
			remove_ruler_trait = leader_trait_oripathy	# 源石病
		}
	}
}

# DOCTOR作为新的ruler开始游戏
country_event = {
	id = ark_game_start.313
	hide_window = yes
	location = ROOT

	is_triggered_only = yes

	immediate = {
		every_owned_leader = {
			limit = {
				has_leader_flag = ark_leader_doctor
			}
			remove_trait = leader_trait_oripathy		# 源石病
			remove_trait = trait_ruler_corvette_focus
			remove_trait = trait_ruler_destroyer_focus
			remove_trait = trait_ruler_cruiser_focus
			remove_trait = trait_ruler_battleship_focus
			remove_trait = trait_ruler_recruiter
			remove_trait = trait_ruler_from_the_ranks
			remove_trait = trait_ruler_fortifier
			remove_trait = trait_ruler_logistic_understanding
			remove_trait = trait_ruler_military_pioneer
			remove_trait = trait_ruler_warlike
			remove_trait = trait_ruler_architectural_sense
			remove_trait = trait_ruler_frontier_spirit
			remove_trait = trait_ruler_world_shaper
			remove_trait = trait_ruler_home_in_the_sky
			remove_trait = trait_ruler_industrialist
			remove_trait = trait_ruler_eye_for_talent
			remove_trait = trait_ruler_deep_connections
			remove_trait = trait_ruler_charismatic
			remove_trait = trait_ruler_champion_of_the_people
			remove_trait = trait_ruler_expansionist
			remove_trait = trait_ruler_fertility_preacher
			remove_trait = trait_ruler_investor
			remove_trait = trait_ruler_space_miner
			remove_trait = trait_ruler_explorer
			remove_trait = leader_trait_reformer
			remove_trait = leader_trait_resilient
			remove_trait = leader_trait_tiandaochouqin	# 天道酬勤
		}
	}
}

# 博士不再是国家领导人(用以清除错误的领袖技能)
country_event = {
	id = ark_game_start.314
	hide_window = yes
	location = ROOT
	is_triggered_only = yes
	trigger = {
		any_owned_leader = {
			leader_class = ruler
			NOT = { has_leader_flag = ark_leader_doctor }
		}
	}

	immediate = {
		every_owned_leader = {
			limit = { leader_class = ruler }
			remove_ruler_trait = trait_ruler_efficient_infrastructure
			remove_ruler_trait = trait_ruler_babel_evil_spirit_w
			remove_ruler_trait = trait_ruler_babel_evil_spirit_l
			remove_ruler_trait = trait_ruler_babel_evil_spirit_r
			remove_ruler_trait = trait_ruler_meet_end
		}
	}
}